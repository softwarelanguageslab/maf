; Changes:
; * removed: 1
; * added: 0
; * swaps: 0
; * negated predicates: 3
; * swapped branches: 1
; * calls to id fun: 1
(letrec ((MaakLampje (lambda (aantal)
                       (letrec ((state 'off)
                                (on! (lambda ()
                                       (set! state 'on)))
                                (off! (lambda ()
                                        (set! state 'off)))
                                (broken! (lambda ()
                                           (set! state 'broken)))
                                (on? (lambda ()
                                       (eq? state 'on)))
                                (off? (lambda ()
                                        (eq? state 'off)))
                                (broken? (lambda ()
                                           (eq? state 'broken)))
                                (switch! (lambda ()
                                           (set! aantal (- aantal 1))
                                           (<change>
                                              (if (< aantal 0)
                                                 (broken!)
                                                 (if (off?) (on!) (if (on?) (off!) #f)))
                                              ((lambda (x) x) (if (< aantal 0) (broken!) (if (off?) (on!) (if (on?) (off!) #f)))))
                                           (not (broken?))))
                                (change! (lambda (nieuw)
                                           (off!)
                                           (<change>
                                              (set! aantal nieuw)
                                              ())
                                           'changed))
                                (dispatch (lambda (msg)
                                            (if (eq? msg 'switch!)
                                               (switch!)
                                               (if (<change> (eq? msg 'on?) (not (eq? msg 'on?)))
                                                  (on?)
                                                  (if (eq? msg 'off?)
                                                     (off?)
                                                     (if (<change> (eq? msg 'test?) (not (eq? msg 'test?)))
                                                        (broken?)
                                                        (if (eq? msg 'change!)
                                                           change!
                                                           (error "Message not understood.")))))))))
                          dispatch)))
         (philips (MaakLampje 5)))
   (if (not (philips 'test?))
      (if (not (philips 'on?))
         (if (philips 'off?)
            (if (philips 'switch!)
               (if (philips 'switch!)
                  (if (philips 'switch!)
                     (<change>
                        (if (philips 'switch!)
                           (if (philips 'switch!)
                              (if (not (philips 'switch!))
                                 (if (philips 'test?)
                                    (if (begin ((philips 'change!) 10) (not (philips 'test?)))
                                       (philips 'off?)
                                       #f)
                                    #f)
                                 #f)
                              #f)
                           #f)
                        #f)
                     (<change>
                        #f
                        (if (not (philips 'switch!))
                           (if (philips 'switch!)
                              (if (not (philips 'switch!))
                                 (if (philips 'test?)
                                    (if (begin ((philips 'change!) 10) (not (philips 'test?)))
                                       (philips 'off?)
                                       #f)
                                    #f)
                                 #f)
                              #f)
                           #f)))
                  #f)
               #f)
            #f)
         #f)
      #f))