; Changes:
; * removed: 6
; * added: 1
; * swaps: 4
; * negated predicates: 1
; * swapped branches: 0
; * calls to id fun: 4
(letrec ((BIAS 1000)
         (NMBR-prefix 1)
         (PAIR-prefix 2)
         (NULL-prefix 3)
         (MASK-prefix 4)
         (NMBR (* NMBR-prefix BIAS))
         (PAIR (* PAIR-prefix BIAS))
         (NULL (* NULL-prefix BIAS))
         (MASK (* MASK-prefix BIAS))
         (PREFIX (lambda (val)
                   (<change>
                      (quotient (abs val) BIAS)
                      ((lambda (x) x) (quotient (abs val) BIAS)))))
         (VALUE (lambda (val)
                  (remainder (abs val) BIAS)))
         (MAKE (lambda (prefix val)
                 (+ prefix val)))
         (FREE 0)
         (SIZE 16)
         (THE-CARS (make-vector SIZE NULL))
         (THE-CDRS (make-vector SIZE NULL))
         (car (lambda (cons-val)
                (if (pair? cons-val)
                   (vector-ref THE-CARS (VALUE cons-val))
                   (error "pair expected"))))
         (cdr (lambda (cons-val)
                (if (pair? cons-val)
                   (vector-ref THE-CDRS (VALUE cons-val))
                   (error "pair expected"))))
         (set-car! (lambda (cons-val car-val)
                     (if (pair? cons-val)
                        (vector-set! THE-CARS (VALUE cons-val) car-val)
                        (error "pair expected"))))
         (set-cdr! (lambda (cons-val cdr-val)
                     (if (pair? cons-val)
                        (vector-set! THE-CDRS (VALUE cons-val) cdr-val)
                        (error "pair expected"))))
         (number? (lambda (val)
                    (eq? (PREFIX val) NMBR-prefix)))
         (pair? (lambda (val)
                  (eq? (PREFIX val) PAIR-prefix)))
         (null? (lambda (val)
                  (<change>
                     (eq? (PREFIX val) NULL-prefix)
                     ((lambda (x) x) (eq? (PREFIX val) NULL-prefix)))))
         (MASK? (lambda (val)
                  (eq? (PREFIX val) MASK-prefix)))
         (cons (lambda (car-val cdr-val)
                 (if (= FREE SIZE) (RECLAIM) #f)
                 (let ((hold FREE))
                    (set! FREE (+ FREE 1))
                    (<change>
                       ()
                       (display hold))
                    (vector-set! THE-CARS hold car-val)
                    (vector-set! THE-CDRS hold cdr-val)
                    (MAKE PAIR hold))))
         (ROOT NULL)
         (NEW-CARS (make-vector SIZE NULL))
         (NEW-CDRS (make-vector SIZE NULL))
         (RECLAIM (lambda ()
                    (letrec ((relocate-old-result-in-new (lambda (val)
                                                           (<change>
                                                              (if (pair? val)
                                                                 (let* ((old (VALUE val))
                                                                        (old-car (vector-ref THE-CARS old))
                                                                        (old-cdr (vector-ref THE-CDRS old)))
                                                                    (if (MASK? old-car)
                                                                       old-cdr
                                                                       (let* ((new FREE)
                                                                              (pair (MAKE PAIR new)))
                                                                          (set! FREE (+ FREE 1))
                                                                          (vector-set! NEW-CARS new old-car)
                                                                          (vector-set! NEW-CDRS new old-cdr)
                                                                          (vector-set! THE-CARS old MASK)
                                                                          (vector-set! THE-CDRS old pair)
                                                                          pair)))
                                                                 val)
                                                              ((lambda (x) x)
                                                                 (if (<change> (pair? val) (not (pair? val)))
                                                                    (let* ((old (VALUE val))
                                                                           (old-car (vector-ref THE-CARS old))
                                                                           (old-cdr (vector-ref THE-CDRS old)))
                                                                       (if (MASK? old-car)
                                                                          old-cdr
                                                                          (let* ((new FREE)
                                                                                 (pair (MAKE PAIR new)))
                                                                             (set! FREE (+ FREE 1))
                                                                             (vector-set! NEW-CARS new old-car)
                                                                             (<change>
                                                                                (vector-set! NEW-CDRS new old-cdr)
                                                                                ())
                                                                             (<change>
                                                                                (vector-set! THE-CARS old MASK)
                                                                                (vector-set! THE-CDRS old pair))
                                                                             (<change>
                                                                                (vector-set! THE-CDRS old pair)
                                                                                (vector-set! THE-CARS old MASK))
                                                                             pair)))
                                                                    val)))))
                             (gc-flip (lambda ()
                                        (let ((temp THE-CDRS))
                                           (set! THE-CDRS NEW-CDRS)
                                           (set! NEW-CDRS temp))
                                        (let ((temp THE-CARS))
                                           (set! THE-CARS NEW-CARS)
                                           (set! NEW-CARS temp))))
                             (gc-loop (lambda (scan)
                                        (if (= scan FREE)
                                           (gc-flip)
                                           (let ((old-car (vector-ref NEW-CARS scan))
                                                 (old-cdr (vector-ref NEW-CDRS scan)))
                                              (vector-set! NEW-CARS scan (relocate-old-result-in-new old-car))
                                              (<change>
                                                 (vector-set! NEW-CDRS scan (relocate-old-result-in-new old-cdr))
                                                 ((lambda (x) x) (vector-set! NEW-CDRS scan (relocate-old-result-in-new old-cdr))))
                                              (gc-loop (+ scan 1)))))))
                       (set! FREE 0)
                       (set! ROOT (relocate-old-result-in-new ROOT))
                       (gc-loop 0))))
         (_ (lambda (val)
              (MAKE NMBR val)))
         (_11 (_ 11))
         (_12 (_ 12))
         (_13 (_ 13))
         (_14 (_ 14))
         (_15 (_ 15))
         (_21 (_ 21))
         (_22 (_ 22))
         (_31 (_ 31))
         (_32 (_ 32))
         (_33 (_ 33))
         (_34 (_ 34))
         (_35 (_ 35))
         (_36 (_ 36))
         (_41 (_ 41))
         (_42 (_ 42))
         (_43 (_ 43))
         (_51 (_ 51))
         (_52 (_ 52))
         (_61 (_ 61))
         (_62 (_ 62))
         (show (lambda ()
                 (<change>
                    (display "cars > ")
                    ())
                 (<change>
                    (display THE-CARS)
                    (newline))
                 (<change>
                    (newline)
                    (display THE-CARS))
                 (<change>
                    (display "cdrs > ")
                    ())
                 (display THE-CDRS)
                 (<change>
                    (newline)
                    ())
                 (<change>
                    (display "ROOT > ")
                    ())
                 (<change>
                    (display ROOT)
                    ())
                 (display "  FREE > ")
                 (<change>
                    (display FREE)
                    (newline))
                 (<change>
                    (newline)
                    (display FREE)))))
   (set! ROOT (cons (cons (cons _11 _12) (cons _13 (cons _14 _15))) ROOT))
   (cons _21 _22)
   (set! ROOT (cons (cons _31 (cons (cons _32 _33) (cons _34 (cons _35 _36)))) ROOT))
   (set-cdr! (cdr (car ROOT)) ROOT)
   (cons _41 (cons _42 _43))
   (set! ROOT (cons (cons _51 _52) ROOT))
   (<change>
      (set-car! (car ROOT) (cdr (car (cdr ROOT))))
      (show))
   (<change>
      (show)
      (set-car! (car ROOT) (cdr (car (cdr ROOT)))))
   (cons _61 _62)
   (show))