; Changes:
; * removed: 0
; * added: 1
; * swaps: 0
; * negated predicates: 1
; * swapped branches: 0
; * calls to id fun: 2
(letrec ((MaakLampje (lambda (aantal)
                       (letrec ((state 'off)
                                (on! (lambda ()
                                       (set! state 'on)))
                                (off! (lambda ()
                                        (set! state 'off)))
                                (broken! (lambda ()
                                           (set! state 'broken)))
                                (on? (lambda ()
                                       (<change>
                                          (eq? state 'on)
                                          ((lambda (x) x) (eq? state 'on)))))
                                (off? (lambda ()
                                        (eq? state 'off)))
                                (broken? (lambda ()
                                           (eq? state 'broken)))
                                (switch! (lambda ()
                                           (set! aantal (- aantal 1))
                                           (if (< aantal 0)
                                              (broken!)
                                              (if (off?) (on!) (if (on?) (off!) #f)))
                                           (<change>
                                              ()
                                              -)
                                           (not (broken?))))
                                (change! (lambda (nieuw)
                                           (off!)
                                           (<change>
                                              (set! aantal nieuw)
                                              ((lambda (x) x) (set! aantal nieuw)))
                                           'changed))
                                (dispatch (lambda (msg)
                                            (if (<change> (eq? msg 'switch!) (not (eq? msg 'switch!)))
                                               (switch!)
                                               (if (eq? msg 'on?)
                                                  (on?)
                                                  (if (eq? msg 'off?)
                                                     (off?)
                                                     (if (eq? msg 'test?)
                                                        (broken?)
                                                        (if (eq? msg 'change!)
                                                           change!
                                                           (error "Message not understood.")))))))))
                          dispatch)))
         (philips (MaakLampje 5)))
   (if (not (philips 'test?))
      (if (not (philips 'on?))
         (if (philips 'off?)
            (if (philips 'switch!)
               (if (philips 'switch!)
                  (if (philips 'switch!)
                     (if (philips 'switch!)
                        (if (philips 'switch!)
                           (if (not (philips 'switch!))
                              (if (philips 'test?)
                                 (if (begin ((philips 'change!) 10) (not (philips 'test?)))
                                    (philips 'off?)
                                    #f)
                                 #f)
                              #f)
                           #f)
                        #f)
                     #f)
                  #f)
               #f)
            #f)
         #f)
      #f))